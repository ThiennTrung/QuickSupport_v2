[
  {
    "code": "infoBN",
    "query": "SELECT BA.SOBENHAN, BN.TENBENHNHAN, PB.TENPHONGBAN,LT.LUUTRU_ID ,LT.LUUTRU_CURRENT, FORMAT(TN.THOIGIANTIEPNHAN, 'dd/MM/yyyy HH:mm:ss') AS  NGAYTIEPNHAN, BA.TRANGTHAI as TRANGTHAI_BA, TN.TRANGTHAI as TRANGTHAI_TN,BN.MAYTE, BN.BENHNHAN_ID,TN.SOTIEPNHAN, TN.TIEPNHAN_ID, BA.BENHAN_ID,FORMAT(BA.THOIGIANRAVIEN, 'dd/MM/yyyy HH:mm:ss') AS TGRAVIEN FROM dbo.TT_BENHNHAN BN LEFT JOIN dbo.TT_TIEPNHAN TN ON TN.BENHNHAN_ID = BN.BENHNHAN_ID LEFT JOIN dbo.TT_NOITRU_BENHAN BA ON BA.TIEPNHAN_ID = TN.TIEPNHAN_ID LEFT JOIN dbo.TT_NOITRU_LUUTRU LT ON LT.BENHAN_ID = BA.BENHAN_ID LEFT JOIN dbo.TM_PHONGBAN PB ON PB.PHONGBAN_ID = LT.PHONGBAN_ID WHERE (BN.MAYTE = @MAYTE OR @MAYTE IS NULL) AND (BA.SOBENHAN = @SOBENHAN OR @SOBENHAN IS null) ORDER BY TN.TIEPNHAN_ID",
    "param": {
      "MAYTE": "",
      "SOBENHAN": ""
    }
  },
  {
    "code": "infoBNByID",
    "query": "SELECT BA.SOBENHAN ,BN.TENBENHNHAN ,PB.TENPHONGBAN ,LT.LUUTRU_ID ,LT.LUUTRU_CURRENT ,FORMAT(TN.THOIGIANTIEPNHAN, 'dd/MM/yyyy HH:mm:ss') AS  NGAYTIEPNHAN ,BA.TRANGTHAI AS TRANGTHAI_BA ,tn.TRANGTHAI AS TRANGTHAI_TN ,BN.MAYTE ,BN.BENHNHAN_ID ,TN.SOTIEPNHAN,tn.TIEPNHAN_ID ,BA.BENHAN_ID ,FORMAT(BA.THOIGIANRAVIEN, 'dd/MM/yyyy HH:mm:ss') AS TGRAVIEN FROM dbo.TT_BENHNHAN BN LEFT JOIN dbo.TT_TIEPNHAN tn ON tn.BENHNHAN_ID = BN.BENHNHAN_ID LEFT JOIN dbo.TT_NOITRU_BENHAN BA ON BA.TIEPNHAN_ID = tn.TIEPNHAN_ID LEFT JOIN dbo.TT_NOITRU_LUUTRU LT ON LT.BENHAN_ID = BA.BENHAN_ID LEFT JOIN dbo.TM_PHONGBAN PB ON PB.PHONGBAN_ID = LT.PHONGBAN_ID WHERE (BN.BENHNHAN_ID = @BENHNHAN_ID OR @BENHNHAN_ID IS NULL) AND (BA.BENHAN_ID = @BENHAN_ID OR @BENHAN_ID IS NULL) AND (TN.TIEPNHAN_ID = @TIEPNHAN_ID OR @TIEPNHAN_ID IS NULL) ORDER BY BA.BENHAN_ID",
    "param": {
      "BENHNHAN_ID": "",
      "BENHAN_ID": "",
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "AllDV",
    "query": "SELECT yc.DVYEUCAU_ID, yc.SOPHIEUYEUCAU ,ISNULL(NC.MANHOMDICHVU, 'KHAC') AS MALOAI ,ISNULL(NC.TENNHOMDICHVU, 'KHAC') AS LOAI ,dv.DICHVU_ID ,dv.TENDICHVU ,YC.HUYYEUCAU AS HUY ,TRANGTHAI ,FORMAT(yc.NGAYGIOYEUCAU, 'dd/MM/yyyy HH:mm:ss') AS NGAYGIOYEUCAU ,tpyc.TENPHONGBAN AS NOIYEUCAU ,tp.TENPHONGBAN AS NOITHUCHIEN ,yc.BENHAN_ID ,yc.DUOCPHEPTHUCHIEN AS DUOCPHEPTH, ISNULL(yc.KHAMCHUYENKHOA,0) as KHAMCK FROM TT_DVYEUCAU yc (NOLOCK) INNER JOIN TM_DICHVU dv ON yc.DICHVU_ID = dv.DICHVU_ID INNER JOIN TM_NHOMDICHVU tn ON dv.NHOMDICHVU_ID = tn.NHOMDICHVU_ID LEFT JOIN (SELECT CH.NHOMDICHVU_ID ,CH.MANHOMDICHVU ,CH.TENNHOMDICHVU FROM TM_NHOMDICHVU CH WHERE CAP = 1) NC ON NC.MANHOMDICHVU = LEFT(tn.MANHOMDICHVU, 2) LEFT JOIN TM_PHONGBAN tp ON yc.NOITHUCHIEN_ID = tp.PHONGBAN_ID LEFT JOIN TM_PHONGBAN tpyc ON yc.NOIYEUCAU_ID = tpyc.PHONGBAN_ID WHERE yc.TIEPNHAN_ID = @TIEPNHAN_ID ORDER BY NC.NHOMDICHVU_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "DVChuaHT",
    "query": "SELECT yc.DVYEUCAU_ID,NC.TENNHOMDICHVU AS LOAI ,dv.DICHVU_ID ,dv.TENDICHVU ,YC.HUYYEUCAU as HUY,TRANGTHAI ,tp.TENPHONGBAN AS NOITHUCHIEN ,yc.BENHAN_ID ,yc.DUOCPHEPTHUCHIEN as DUOCPHEPTH FROM TT_DVYEUCAU yc (NOLOCK) INNER JOIN TM_DICHVU dv ON yc.DICHVU_ID = dv.DICHVU_ID INNER JOIN TM_NHOMDICHVU tn ON dv.NHOMDICHVU_ID = tn.NHOMDICHVU_ID LEFT JOIN ( SELECT CH.NHOMDICHVU_ID,CH.MANHOMDICHVU, CH.TENNHOMDICHVU FROM TM_NHOMDICHVU CH  WHERE CAP = 1) NC ON  NC.MANHOMDICHVU = LEFT(tn.MANHOMDICHVU,2) LEFT JOIN TM_PHONGBAN tp ON yc.NOITHUCHIEN_ID = tp.PHONGBAN_ID WHERE yc.TIEPNHAN_ID = @TIEPNHAN_ID AND (yc.TRANGTHAI != 'HOANTAT' OR yc.DUOCPHEPTHUCHIEN = '0')",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "TTKHAMBENH",
    "query": "SELECT KB.KHAMBENH_ID,dvkb.TENDICHVU, KB.THOIGIANKHAM,ld.DICTIONARY_NAME AS HUONGGIAIQUYET,KB.HUONGGIAIQUYET_ID,KBTT.LOAITOATHUOC,KBTT.HUYTOATHUOC,TT.TOATHUOC_ID,D.TENDUOCDAYDU FROM TT_NGOAITRU_KHAMBENH KB (NOLOCK) LEFT JOIN TT_NGOAITRU_TOATHUOC TT (NOLOCK) ON TT.KHAMBENH_ID = KB.KHAMBENH_ID LEFT JOIN TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT ON TT.KHAMBENH_TOATHUOC_ID = KBTT.KHAMBENH_TOATHUOC_ID LEFT join TM_DUOC D on D.DUOC_ID = tt.DUOC_ID LEFT join LST_DICTIONARY ld ON KB.HUONGGIAIQUYET_ID = ld.DICTIONARY_ID and ld.DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh' LEFT JOIN TM_DICHVU dvkb ON dvkb.DICHVU_ID = kb.DICHVU_ID where KB.TIEPNHAN_ID = @TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "ALLVIENPHI",
    "query": "SELECT VIENPHI_ID, coalesce(td1.TENDICHVU,td.TENDUOCDAYDU,td2.TENDICHVU)  AS NOIDUNG ,COALESCE(VP.DUOC_ID, VP.DICHVU_ID,tnl.DICHVU_CONGCHAMSOC_ID) AS NOIDUNG_ID,CAST(VP.SOLUONG as DECIMAL(10, 3)) as SOLUONG, VP.SOLONHAP_ID, VP.HUY,VP.BENHAN_ID, DATHANHTOAN, DATHUCHIEN,VP.BHYTDONGTIEN AS BNTUTRA, KHONGTHUTIEN, BENHNHAN_PHAITHANHTOAN, GIATRI_BENHNHAN_DATHANHTOAN, REF_ID, REF_TABLE,LOAI_CHIPHI, DONGIA_DOANHTHU, THANHTIEN_DOANHTHU, VP.BHYT_DONGIA, VP.BHYT_THANHTIEN, VP.BHYT_THANHTIEN_CHITRA, VP.BHTN_THANHTIEN_CHITRA, VP.MIENGIAM_GIATRI,VP.DANGKY_ID,CASE WHEN VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET' AND VP.DICHVU_ID IS NULL THEN N'GIƯỜNG' WHEN VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET' AND VP.DICHVU_ID IS NOT NULL THEN N'CÔNG CHĂM SÓC' WHEN VP.DICHVU_ID IS NOT NULL THEN UPPER(NDV.TENNHOMDICHVU) WHEN VP.DUOC_ID IS NOT NULL THEN CASE WHEN LD.LOAIVATTU_ID = 'V' THEN N'VẬT TƯ Y TẾ' ELSE CONCAT(N'THUỐC (',LD.LOAIVATTU_ID,')') END ELSE N'KHÁC' END AS LOAI FROM TT_VIENPHI VP (NOLOCK) LEFT join TM_DUOC td on VP.DUOC_ID = td.DUOC_ID and VP.REF_TABLE NOT IN ('TT_DVYEUCAU', 'TT_NOITRU_LUUTRUCHITIET') LEFT JOIN TM_DICHVU td1 on VP.DICHVU_ID = td1.DICHVU_ID AND VP.REF_TABLE = 'TT_DVYEUCAU' LEFT join TT_NOITRU_LUUTRUCHITIET tnl ON VP.REF_ID = tnl.LUUTRUCHITIET_ID and VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET' LEFT join TM_DICHVU td2 ON td2.DICHVU_ID = tnl.LOAIGIUONGBENH_ID LEFT JOIN ( SELECT ISNULL(CT.TENNHOMDICHVU,A.TENNHOMDICHVU) AS TENNHOMDICHVU,A.NHOMDICHVU_ID FROM TM_NHOMDICHVU A LEFT JOIN TM_NHOMDICHVU CT ON CT.NHOMDICHVU_ID = A.CAPTREN_ID) NDV ON NDV.NHOMDICHVU_ID = td1.NHOMDICHVU_ID AND VP.DICHVU_ID IS NOT NULL LEFT JOIN TM_LOAIDUOC LD  ON LD.LOAIDUOC_ID = td.LOAIDUOC_ID WHERE TIEPNHAN_ID = @TIEPNHAN_ID AND ( (@DICHVU = 1 AND VP.REF_TABLE = 'TT_DVYEUCAU') or (@THUOC = 1 AND VP.DUOC_ID IS NOT NULL AND VP.REF_TABLE != 'TT_PHAUTHUAT_VTYT') OR (@VTYTPT = 1 AND VP.REF_TABLE = 'TT_PHAUTHUAT_VTYT') OR (@GIUONG = 1 AND VP.DICHVU_ID IS NULL AND VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET') OR (@CCS = 1 AND VP.DICHVU_ID IS NOT NULL AND VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET') ) AND (@BHYT = 0 OR (@BHYT = 1 AND VP.BHYT_THANHTIEN_CHITRA > 0 )) ORDER BY VP.DONGIA_DOANHTHU",
    "param": {
      "TIEPNHAN_ID": "",
      "THUOC": "",
      "VTYTPT": "",
      "DICHVU": "",
      "GIUONG": "",
      "CCS": "",
      "BHYT": ""
    }
  },
  {
    "code": "SUMVP",
    "query": "DECLARE @TONGTAMUNG DECIMAL(18, 2) = (SELECT SUM(GIATRIHOADON) FROM TT_HOADON(NOLOCK) WHERE LOAIHOADON = 'TU' AND DATHANHTOAN = '1' AND HUYHOADON = '0' AND HOANTRA = '0' AND TRANGTHAI <> 'DAHOANUNG' AND TIEPNHAN_ID = @TIEPNHAN_ID AND ((GHICHU NOT LIKE N'%TU-EX%' OR ISNULL(GHICHU, '') = '' OR ISNULL(THUTHEM, 0) = 0))) DECLARE @TTGOI DECIMAL(18, 2) = (SELECT SUM(THANHTIEN_DOANHTHU) FROM TT_VIENPHI(NOLOCK) WHERE TIEPNHAN_ID = 5905 AND HUY != '1' AND DANGKY_ID IS NOT NULL) SELECT ISNULL(SUM(THANHTIEN_DOANHTHU),0) AS sTHANHTIEN_DOANHTHU ,ISNULL(SUM(BHTN_THANHTIEN_CHITRA),0)  AS sBHTN_THANHTIEN_CHITRA ,ISNULL(SUM(BHYT_THANHTIEN_CHITRA),0)  AS sBHYT_THANHTIEN_CHITRA ,ISNULL(SUM(MIENGIAM_GIATRI),0)  AS sMIENGIAM_GIATRI ,ISNULL(SUM(BENHNHAN_PHAITHANHTOAN),0)  AS sBENHNHAN_PHAITHANHTOAN ,ISNULL(SUM(GIATRI_BENHNHAN_DATHANHTOAN),0)  AS sGIATRI_BENHNHAN_DATHANHTOAN ,ISNULL(@TONGTAMUNG, 0) AS sTAMUNG ,ISNULL(SUM(THANHTIEN_DOANHTHU), 0) - ISNULL(SUM(BHTN_THANHTIEN_CHITRA), 0) - ISNULL(SUM(BHYT_THANHTIEN_CHITRA),0) -  ISNULL(SUM(MIENGIAM_GIATRI), 0) -ISNULL(@TONGTAMUNG, 0) - ISNULL(SUM(GIATRI_BENHNHAN_DATHANHTOAN),0) AS SCONLAI,ISNULL(@TTGOI,0) AS sGOI FROM TT_VIENPHI(NOLOCK) WHERE TIEPNHAN_ID = @TIEPNHAN_ID AND HUY != '1'",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "CSRIPTVP",
    "query": "SELECT VIENPHI_ID, coalesce(td1.TENDICHVU,td.TENDUOCDAYDU,td2.TENDICHVU)  AS NOIDUNG , VP.SOLONHAP_ID, VP.HUY,VP.BENHAN_ID,\n\tDATHANHTOAN,\n\tDATHUCHIEN,\n\tKHONGTHUTIEN,\n\tBENHNHAN_PHAITHANHTOAN,\n\tGIATRI_BENHNHAN_DATHANHTOAN,\n\tREF_ID,\n\tREF_TABLE,\n\tDONGIA_DOANHTHU,\n\tTHANHTIEN_DOANHTHU,\n\tVP.BHYT_DONGIA,\n\tVP.BHYT_THANHTIEN,\n\tVP.BHYT_THANHTIEN_CHITRA,\n\t *\nFROM TT_VIENPHI VP\nLEFT join TM_DUOC td on VP.DUOC_ID = td.DUOC_ID and VP.REF_TABLE NOT IN ('TT_DVYEUCAU', 'TT_NOITRU_LUUTRUCHITIET')\nLEFT JOIN TM_DICHVU td1 on VP.DICHVU_ID = td1.DICHVU_ID AND VP.REF_TABLE = 'TT_DVYEUCAU'\nLEFT join TT_NOITRU_LUUTRUCHITIET tnl ON VP.REF_ID = tnl.LUUTRUCHITIET_ID and VP.REF_TABLE = 'TT_NOITRU_LUUTRUCHITIET'\nLEFT join TM_DICHVU td2 ON td2.DICHVU_ID = tnl.LOAIGIUONGBENH_ID\nWHERE VP.TIEPNHAN_ID = @TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "SKHAMBENH_ID",
    "query": "SELECT FORMAT(KB.THOIGIANBATDAU, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANKHAM,KB.TRANGTHAIYLENH , KB.KHAMBENH_ID FROM TT_NOITRU_KHAMBENH KB (NOLOCK) WHERE KB.BENHAN_ID = @BENHAN_ID AND (@THOIGIANKHAM is null or CONVERT(DATE,KB.THOIGIANBATDAU) = CONVERT(DATE,@THOIGIANKHAM) ) AND ((@THUOC = 1 AND KB.ISYLENHVTYT = '0') or (@VTYT = 1 AND KB.ISYLENHVTYT = '1'))ORDER BY KB.THOIGIANBATDAU",
    "param": {
      "BENHAN_ID": "",
      "THOIGIANKHAM": "",
      "THUOC": "",
      "VTYT": ""
    }
  },
  {
    "code": "STHUOCNOITRU",
    "query": "SELECT KB.KHAMBENH_ID ,CAST(NHOMHUOCPHA AS INT) AS TPHA , td.DUOC_ID ,td.TENDUOCDAYDU ,CAST(tnt.SOLUONGTHUCLINH AS DECIMAL(10, 3)) AS SLTHUCLINH ,tnt.TOATHUOC_ID ,tnt.TINHTIEN ,KB.LOAITOATHUOC AS LOAITT ,KB.THUOCRAVIEN AS THUOCRV ,CAST(tnt.SOLAN AS INT) AS SOLAN ,tnt.PHAMVI_ID ,tnt.PHONGBANRATOA_ID AS PBRATOA,tp.TENPHONGBAN,KB.KHODUOC_ID,tk.TENKHO AS KHODUOC,tnt.KHOTAO_ID,tk1.TENKHO AS KHOTAO,tnt.CHUNGTU_ID FROM TT_NOITRU_KHAMBENH KB (NOLOCK) INNER JOIN TT_NOITRU_TOATHUOC tnt (NOLOCK) ON KB.KHAMBENH_ID = tnt.KHAMBENH_ID AND tnt.TIEPNHAN_ID = @TIEPNHAN_ID LEFT JOIN TM_DUOC td ON tnt.DUOC_ID = td.DUOC_ID LEFT JOIN TM_KHODUOC tk ON KB.KHODUOC_ID = tk.KHODUOC_ID LEFT JOIN TM_KHODUOC tk1 ON tnt.KHOTAO_ID = tk1.KHODUOC_ID LEFT JOIN TM_PHONGBAN tp ON tnt.PHONGBANRATOA_ID = tp.PHONGBAN_ID WHERE tnt.KHAMBENH_ID = @KHAMBENH_ID ORDER BY tnt.TOATHUOC_ID",
    "param": {
      "KHAMBENH_ID": ""
    }
  },
  {
    "code": "SCHUNGTU",
    "query": "SELECT LOAI = N'Phiếu lĩnh', MA = 'PL', CT.SOLONHAP_ID, FORMAT(PL.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS NGAYCHUNGTU, PL.MACHUNGTU, PL.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, PL.KHOXUAT_ID AS KX_ID,kx.TENKHO AS KHOXUAT, PL.KHONHAP_ID  AS KN_ID,kn.TENKHO AS KHONHAP ,CAST(CT.SOLUONGYEUCAU AS DECIMAL(10, 3)) AS SOLUONGYEUCAU ,CAST(CT.SOLUONGDAXUAT AS DECIMAL(10, 3)) AS SOLUONGDAXUAT ,'' AS DIENGIAINGHIEPVUPHATSINH, PL.CHUNGTULIENQUAN_ID FROM TT_DUOC_PHIEULINH_CHITIET CT INNER JOIN TT_DUOC_PHIEULINH PL ON PL.CHUNGTU_ID = CT.CHUNGTU_ID LEFT JOIN TM_KHODUOC kn ON kn.KHODUOC_ID = PL.KHONHAP_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = PL.KHOXUAT_ID WHERE CT.TOATHUOCNOITRU_ID = @TOATHUOC_ID UNION ALL SELECT ld.DICTIONARY_NAME as LOAI,tdc.MUCDICHCHUNGTU_CODE as MA, CT.SOLONHAP_ID, FORMAT(tdc.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') as NGAYCHUNGTU,tdc.MACHUNGTU,tdc.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, tdc.KHOXUAT_ID as KX_ID,kx.TENKHO AS KHOXUAT, tdc.KHONHAP_ID as KN_ID,kn.TENKHO AS KHONHAP, CAST(CT.SOLUONGYEUCAU as DECIMAL(10, 3)) as SOLUONGYEUCAU, CAST(CT.SOLUONGDAXUAT as DECIMAL(10, 3)) as SOLUONGDAXUAT, tdc.DIENGIAINGHIEPVUPHATSINH,tdc.CHUNGTULIENQUAN_ID FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER join TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID INNER join LST_DICTIONARY ld (NOLOCK) on ld.DICTIONARY_ID = tdc.MUCDICHCHUNGTU_ID AND ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' LEFT JOIN TM_KHODUOC kn ON kn.KHODUOC_ID = tdc.KHONHAP_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = tdc.KHOXUAT_ID where CT.TOATHUOCNOITRU_ID =  @TOATHUOC_ID",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "SBENHANCK",
    "query": "SELECT a.*, CONCAT('DELETE FROM ', a.LOAIBENHAN, ' WHERE BENHAN_ID = ', @BENHAN_ID) AS QUERY FROM (SELECT TOP 1 NTCT.BENHAN_ID, NTCT.LOAIBENHAN FROM TT_NOITRU_BENHANCHUYENKHOA_CHITIET NTCT (NOLOCK) WHERE NTCT.BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_NOIKHOA' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_NOIKHOA(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_NGOAIKHOA' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_NGOAIKHOA(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_BONG' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_BONG(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_DALIEU' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_DALIEU(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_UNGBUOU' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_UNGBUOU(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_HHTM' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_HHTM(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID UNION SELECT BENHAN_ID, 'TT_NOITRU_BENHAN_DD_PHCN' AS LOAIBENHAN FROM TT_NOITRU_BENHAN_DD_PHCN(NOLOCK) WHERE BENHAN_ID = @BENHAN_ID) a",
    "param": {
      "BENHAN_ID": ""
    }
  },
  {
    "code": "STHYL",
    "query": "SELECT THYL_ID as ID,LIEUTHUCHIEN as LIEU,TRANGTHAITHUCHIENYLENH as TRANGTHAI,TENTHUOC , CAST(SLXUAT AS DECIMAL(10, 3)) AS SLXUAT ,DONVITINH ,FORMAT(THOIGIANCHIDINH, 'dd/MM/yyyy HH:mm:ss') THOIGIANCHIDINH ,FORMAT(THOIGIANTHUCHIEN, 'dd/MM/yyyy HH:mm:ss') THOIGIANTHUCHIEN,NGUOITHUCHIEN ,LYDO,NGUNGTULAN FROM TT_NOITRU_THUCHIENYLENH WHERE TOATHUOC_ID = @TOATHUOC_ID ORDER BY THYL_ID",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "SDANGTT",
    "query": "SELECT FORMAT(TH.THOIGIANKHAM, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANKHAM, TH.TOATHUOC_ID, TH.TENTHUOC, TH.SLXUAT_THYL, isnull(XSD.SOLUONGDAXUAT_CHUNGTU,0) AS SOLUONGDAXUAT_CHUNGTU FROM  ( SELECT tnk.THOIGIANKHAM, TH.TOATHUOC_ID, sum(SLXUAT) as SLXUAT_THYL ,TENTHUOC FROM TT_NOITRU_THUCHIENYLENH TH LEFT JOIN TT_NOITRU_TOATHUOC tnt ON TH.TOATHUOC_ID = tnt.TOATHUOC_ID LEFT JOIN TT_NOITRU_KHAMBENH tnk ON tnt.KHAMBENH_ID = tnk.KHAMBENH_ID where TH.TIEPNHAN_ID = @TIEPNHAN_ID GROUP BY TH.TOATHUOC_ID,tnk.THOIGIANKHAM,TENTHUOC ) TH left JOIN ( SELECT tdc.MUCDICHCHUNGTU_CODE, CT.TOATHUOCNOITRU_ID,sum(isnull(CT.SOLUONGDAXUAT,0)) AS SOLUONGDAXUAT_CHUNGTU FROM TT_DUOC_CHUNGTU_CHITIET CT INNER join TT_DUOC_CHUNGTU tdc ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID where (ct.TIEPNHAN_ID = @TIEPNHAN_ID OR tdc.TIEPNHAN_ID = @TIEPNHAN_ID) and tdc.MUCDICHCHUNGTU_CODE = 'X13' GROUP BY CT.TOATHUOCNOITRU_ID, tdc.MUCDICHCHUNGTU_CODE) XSD ON TH.TOATHUOC_ID = XSD.TOATHUOCNOITRU_ID WHERE isnull(TH.SLXUAT_THYL,0) <> isnull(XSD.SOLUONGDAXUAT_CHUNGTU,0)",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "SCRIPTDANGTT",
    "query": "SELECT LIEUTHUCHIEN,* FROM TT_NOITRU_THUCHIENYLENH where TOATHUOC_ID in (@SLTTOATHUOC_ID)",
    "param": {
      "SLTTOATHUOC_ID": ""
    }
  },
  {
    "code": "Get_CLSKETQUA",
    "query": "SELECT KQCT.CLSKETQUACHITIET_ID as KQCT_ID,tc.CLSKETQUA_ID as KQ_ID,FORMAT(tc.THOIGIANTHUCHIEN, 'dd/MM/yyyy HH:mm:ss') AS TGTH FROM TT_CLSKETQUACHITIET KQCT (NOLOCK) INNER JOIN TT_CLSKETQUA tc (NOLOCK) ON KQCT.CLSKETQUA_ID = tc.CLSKETQUA_ID AND tc.TIEPNHAN_ID = @TIEPNHAN_ID WHERE KQCT.DVYEUCAU_ID = @DVYEUCAU_ID",
    "param": {
      "TIEPNHAN_ID": "",
      "DVYEUCAU_ID": ""
    }
  },
  {
    "code": "GET_PTTT",
    "query": "SELECT tp.PHAUTHUAT_ID as PT_ID, tp.SOPHIEUPHAUTHUAT as SOPHIEU,FORMAT(tp.THOIGIANBATDAU, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANBATDAU,FORMAT(tp.THOIGIANKETTHUC, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANKETTHUC FROM TT_PHAUTHUAT_YEUCAU YC (NOLOCK) INNER JOIN TT_PHAUTHUAT tp (NOLOCK) ON YC.PHAUTHUAT_ID = tp.PHAUTHUAT_ID WHERE YC.DVYEUCAU_ID =@DVYEUCAU_ID",
    "param": {
      "TIEPNHAN_ID": "",
      "DVYEUCAU_ID": ""
    }
  },
  {
    "code": "GET_KB",
    "query": "SELECT KB.KHAMBENH_ID AS KB_ID ,FORMAT(KB.THOIGIANKHAM, 'dd/MM/yyyy HH:mm:ss') AS TGKHAM , CONCAT(tn.MANHANVIEN,' - ',tn.TENNHANVIEN,' (',tn.MA_BAC_SI,')') AS BACSIKHAM ,tc.TENCHUYENKHOA ,ICD_CHINH = CONCAT(ti.TENICD,' (',ti.MAICD,')') ,ICD_PHU = (SELECT STRING_AGG(CONCAT(ti1.TENICD,' (',ti1.MAICD,')'),';') FROM TT_NGOAITRU_KHAMBENH_ICD a INNER JOIN TM_ICD ti1 ON a.ICD_ID = ti1.ICD_ID where KB.KHAMBENH_ID = KHAMBENH_ID) ,ld.DICTIONARY_NAME AS HUONGGIAIQUYET FROM TT_DVYEUCAU YC INNER JOIN TT_NGOAITRU_KHAMBENH KB ON YC.KHAMBENH_NGOAITRU_ID = KB.KHAMBENH_ID LEFT join TM_ICD ti ON KB.CHANDOANICD_ID = ti.ICD_ID LEFT join TM_NHANVIEN tn ON KB.BACSIKHAM_ID = tn.NHANVIEN_ID LEFT join LST_DICTIONARY ld ON KB.HUONGGIAIQUYET_ID = ld.DICTIONARY_ID and ld.DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh' LEFT join TM_CHUYENKHOA tc on KB.CHUYENKHOA_ID = tc.CHUYENKHOA_ID WHERE DVYEUCAU_ID = @DVYEUCAU_ID",
    "param": {
      "TIEPNHAN_ID": "",
      "DVYEUCAU_ID": ""
    }
  },
  {
    "code": "DV_CK",
    "query": "SELECT dvkb.TENDICHVU AS CONGKHAM, FORMAT(KB.THOIGIANKHAM, 'dd/MM/yyyy HH:mm:ss') as THOIGIANKHAM, YC.TRANGTHAI,YC.HUYYEUCAU as HUY,dv.TENDICHVU FROM TT_NGOAITRU_KHAMBENH KB (NOLOCK) INNER JOIN LST_DICTIONARY ld ON KB.HUONGGIAIQUYET_ID = ld.DICTIONARY_ID AND ld.DICTIONARY_CODE = 'ChiDinhCLS' INNER JOIN TT_DVYEUCAU yc (NOLOCK) ON yc.KHAMBENH_ID = KB.KHAMBENH_ID INNER JOIN TM_DICHVU dv ON dv.DICHVU_ID = yc.DICHVU_ID INNER JOIN TM_DICHVU dvkb ON dvkb.DICHVU_ID = kb.DICHVU_ID WHERE KB.TIEPNHAN_ID = @TIEPNHAN_ID ORDER BY yc.DVYEUCAU_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "sREPORT",
    "query": "SELECT TOP 10 a.REPORT_ID,a.REPORT_CODE,a.REPORT_NAME,a.REPORT_FILE,a.PROCEDURE_FILE FROM TM_REPORT a (NOLOCK) WHERE a.REPORT_NAME LIKE '%' + @KEY + '%' OR a.REPORT_CODE LIKE '%' + @KEY + '%' OR a.REPORT_FILE LIKE '%' + @KEY + '%' OR a.PROCEDURE_FILE LIKE '%' + @KEY + '%' ORDER BY a.REPORT_ID",
    "param": {
      "KEY": ""
    }
  },
  {
    "code": "sSTORED",
    "query": "select TOP 10 '' REPORT_ID ,'' REPORT_CODE ,'' REPORT_NAME ,'' REPORT_FILE ,SPECIFIC_NAME PROCEDURE_FILE from information_schema.routines where routine_type = 'PROCEDURE' AND SPECIFIC_NAME LIKE '%' + @KEY + '%'",
    "param": {
      "KEY": ""
    }
  },
  {
    "code": "sTGLIEU",
    "query": "drop table if EXISTS  #TEMP SELECT THOIGIANLIEU1,THOIGIANLIEU2,THOIGIANLIEU3,THOIGIANLIEU4,THOIGIANLIEU5,THOIGIANLIEU6 INTO #TEMP FROM TT_NOITRU_TOATHUOC (NOLOCK) where TOATHUOC_ID = @TOATHUOC_ID SELECT '1' AS LIEU,\tFORMAT(THOIGIANLIEU1, 'dd/MM/yyyy HH:mm:ss') AS [VALUE] FROM  #TEMP UNION ALL SELECT '2'\t,FORMAT(THOIGIANLIEU2, 'dd/MM/yyyy HH:mm:ss') FROM  #TEMP UNION ALL SELECT '3'\t,\tFORMAT(THOIGIANLIEU3, 'dd/MM/yyyy HH:mm:ss') FROM  #TEMP UNION ALL SELECT '4'\t,FORMAT(THOIGIANLIEU4, 'dd/MM/yyyy HH:mm:ss') FROM  #TEMP UNION ALL SELECT '5'\t,FORMAT(THOIGIANLIEU5, 'dd/MM/yyyy HH:mm:ss') FROM  #TEMP UNION ALL SELECT '6'\t,\tFORMAT(THOIGIANLIEU6, 'dd/MM/yyyy HH:mm:ss') FROM  #TEMP",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "sCTX13",
    "query": "SELECT ROW_NUMBER() OVER (\tORDER BY tdc.CHUNGTU_ID) STT, tdc.DIENGIAINGHIEPVUPHATSINH as DIENGIAI, CAST(CT.SOLUONGDAXUAT AS DECIMAL(10, 3)) AS SLXUAT, CT.SOLONHAP_ID, tdc.MACHUNGTU, tdc.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, tdc.KHOXUAT_ID AS KX_ID, kx.TENKHO AS KHOXUAT FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER JOIN TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = tdc.KHOXUAT_ID WHERE CT.TOATHUOCNOITRU_ID = @TOATHUOC_ID and tdc.MUCDICHCHUNGTU_CODE IN ('X12','X13')",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "SCXUATTH",
    "query": "DROP TABLE IF EXISTS #temp; SELECT KB.KHAMBENH_ID, TT.DUOC_ID,tt.TOATHUOC_ID, FORMAT(KB.THOIGIANKHAM, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANKHAM , D.TENDUOCDAYDU , ISNULL(TT.SOLUONGTHUCLINH, TT.SOLUONG) SOLUONG, ISNULL(CTXUAT.SOLUONGXUAT, 0) SOLUONGXUAT , ISNULL(NGUNG.SOLUONGNGUNG, 0) SOLUONGNGUNG, KB.ISYLENHVTYT, KB.RAVIEN INTO #temp from TT_NOITRU_BENHAN ba (NOLOCK) join TT_NOITRU_KHAMBENH kb (NOLOCK) on ba.BENHAN_ID = kb.BENHAN_ID and ba.BENHAN_ID = @BENHAN_ID join TT_NOITRU_TOATHUOC tt (NOLOCK) on tt.KHAMBENH_ID= kb.KHAMBENH_ID and HUYTOATHUOC !='1' JOIN TM_DUOC D ON D.DUOC_ID = tt.DUOC_ID left join (select  ct.TOATHUOCNOITRU_ID,  sum(ct.SOLUONGDAXUAT) as SoLuongXuat from TT_DUOC_CHUNGTU ctu (NOLOCK) join TT_DUOC_CHUNGTU_CHITIET ct  (NOLOCK) on ctu.CHUNGTU_ID = ct.CHUNGTU_ID where (ct.TIEPNHAN_ID = @TIEPNHAN_ID OR ctu.TIEPNHAN_ID = @TIEPNHAN_ID) and ctu.MUCDICHCHUNGTU_CODE in ('X13','X12') Group by ct.TOATHUOCNOITRU_ID ) as ctXuat on tt.TOATHUOC_ID = ctxuat.TOATHUOCNOITRU_ID left join (select  ct.TOATHUOC_ID,  sum(ct.SOLUONG) as SoLuongNgung from TT_NOITRU_TRATHUOC tra (NOLOCK) join TT_NOITRU_TRATHUOC_CHITIET ct  (NOLOCK) on tra.TRATHUOC_ID = ct.TRATHUOC_ID where tra.BENHAN_ID = @BENHAN_ID Group by ct.TOATHUOC_ID ) as Ngung on tt.TOATHUOC_ID = ngung.TOATHUOC_ID left join (select  yl.TOATHUOC_ID,  sum(yl.SLXUAT) as SoLuongTThucHien from TT_NOITRU_THUCHIENYLENH yl (NOLOCK) join TT_NOITRU_KHAMBENH kb (NOLOCK) on yl.KHAMBENH_ID = kb.KHAMBENH_ID where kb.BENHAN_ID = @BENHAN_ID Group by yl.TOATHUOC_ID ) as ThucHienYL on tt.TOATHUOC_ID = ThucHienYL.TOATHUOC_ID where   isnull(LOAITOATHUOC, '')  not in ('RV','MN') SELECT t.THOIGIANKHAM, t.TENDUOCDAYDU, SL_CHUAXUAT = CAST ( (SUM(SOLUONG) - (SUM(SOLUONGXUAT) + SUM(SOLUONGNGUNG))) AS DECIMAL(10, 3)) , SL_CHUATH =  CAST (CASE\tWHEN t.ISYLENHVTYT = 0\tAND t.RAVIEN = 0 THEN SUM(SOLUONG) - SUM(ISNULL(SOLUONGXUAT, 0)) - SUM(ISNULL(SOLUONGNGUNG, 0)) ELSE\t0 END AS DECIMAL(10, 3)),KHAMBENH_ID, t.TOATHUOC_ID, t.DUOC_ID FROM #temp AS t GROUP BY t.KHAMBENH_ID, t.DUOC_ID, t.ISYLENHVTYT, t.RAVIEN,t.TOATHUOC_ID, t.THOIGIANKHAM, t.TENDUOCDAYDU HAVING (SUM(SOLUONG) - (SUM(SOLUONGXUAT) + SUM(SOLUONGNGUNG))) >0 OR CASE\tWHEN t.ISYLENHVTYT = 0\tAND t.RAVIEN = 0 THEN SUM(SOLUONG) - SUM(ISNULL(SOLUONGXUAT, 0)) - SUM(ISNULL(SOLUONGNGUNG, 0)) ELSE\t0 END > 0",
    "param": {
      "TIEPNHAN_ID": "",
      "BENHAN_ID": ""
    }
  },
  {
    "code": "CHUACOLOVP",
    "query": "SELECT VIENPHI_ID ,D.TENDUOCDAYDU AS NOIDUNG ,ISNULL(VP.DUOC_ID, VP.DICHVU_ID) AS NOIDUNG_ID ,CAST(VP.SOLUONG AS DECIMAL(10, 3)) AS SOLUONG ,VP.SOLONHAP_ID ,VP.HUY ,VP.BENHAN_ID ,DATHANHTOAN ,DATHUCHIEN ,KHONGTHUTIEN ,BENHNHAN_PHAITHANHTOAN ,GIATRI_BENHNHAN_DATHANHTOAN ,REF_ID ,REF_TABLE ,LOAI_CHIPHI ,DONGIA_DOANHTHU ,THANHTIEN_DOANHTHU ,VP.BHYT_DONGIA ,VP.BHYT_THANHTIEN ,VP.BHYT_THANHTIEN_CHITRA ,VP.BHTN_THANHTIEN_CHITRA ,VP.MIENGIAM_GIATRI, VP.DANGKY_ID from TT_VIENPHI VP (NOLOCK) INNER JOIN TM_DUOC D ON D.DUOC_ID = vp.DUOC_ID where VP.TIEPNHAN_ID = @TIEPNHAN_ID and VP.SOLONHAP_ID is null and VP.DUOC_ID is not null and VP.HUY = '0' and VP.SOLUONG > 0",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "INSERTTHYL",
    "query": "sp_ToolKit_InsertTHYL",
    "param": {
      "TOATHUOC_ID": "",
      "NGUOITHUCHIEN": "",
      "BENHVIEN_ID": ""
    }
  },
  {
    "code": "TINHALL",
    "query": "BIL_TINHLAICHIPHI_ALL",
    "param": {
      "TIEPNHAN_ID": "",
      "BENHAN_ID": "",
      "BENHVIEN_ID": ""
    }
  },
  {
    "code": "THETIEPNHAN",
    "query": "SELECT TN.TIEPNHAN_ID,SOBHYT, BHYTTUNGAY, BHYTDENNGAY ,TN.DOITUONG_ID, DT.TENDOITUONG,CHK_MIENDONGCHITRA, NGAYBATDAU5NAM, KHUVUCSONG_ID,TN.BENHVIEN_KCB, BV.TENBENHVIEN FROM  TT_TIEPNHAN TN (NOLOCK) INNER JOIN TM_DOITUONG DT ON DT.DOITUONG_ID = TN.DOITUONG_ID LEFT JOIN TM_BENHVIEN BV ON BV.MABENHVIEN =  TN.BENHVIEN_KCB WHERE TIEPNHAN_ID = @TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "THEBHYT",
    "query": "SELECT SOBHYT_HUONG_ID,SOBHYT, BHYTTUNGAY, BHYTDENNGAY , DOITUONG_ID , ST.TAMNGUNG, CHK_MIENDONGCHITRA, NGAYBATDAU5NAM, KHUVUCSONG_ID, BENHVIEN_KCB, BV.TENBENHVIEN FROM TT_TIEPNHAN_SOTHEBHYT ST (NOLOCK) LEFT JOIN TM_BENHVIEN BV ON BV.MABENHVIEN = ST.BENHVIEN_KCB WHERE TIEPNHAN_ID = @TIEPNHAN_ID ORDER BY SOBHYT_HUONG_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "SKBNGOAITRU",
    "query": "SELECT DISTINCT KB.KHAMBENH_ID ,FORMAT(KB.THOIGIANKHAM, 'dd/MM/yyyy HH:mm:ss') THOIGIANKHAM FROM TT_NGOAITRU_TOATHUOC TT (NOLOCK) INNER JOIN TT_NGOAITRU_KHAMBENH KB (NOLOCK) ON TT.KHAMBENH_ID = KB.KHAMBENH_ID WHERE TT.TIEPNHAN_ID = @TIEPNHAN_ID AND (@THOIGIANKHAM IS NULL OR CONVERT(DATE, KB.THOIGIANKHAM) = CONVERT(DATE, @THOIGIANKHAM)) ORDER BY THOIGIANKHAM",
    "param": {
      "TIEPNHAN_ID": "",
      "THOIGIANKHAM": ""
    }
  },
  {
    "code": "THUOCNGOAITRU",
    "query": "SELECT KBTT.KHAMBENH_TOATHUOC_ID, KBTT.KHAMBENH_ID,TT.TOATHUOC_ID, CAST(TT.SOLUONG as DECIMAL(10, 3)) AS SOLUONG, D.TENDUOCDAYDU, KBTT.LOAITOATHUOC, KBTT.TRANGTHAI, KBTT.HUYTOATHUOC FROM TT_NGOAITRU_KHAMBENH_TOATHUOC KBTT INNER JOIN TT_NGOAITRU_TOATHUOC TT ON KBTT.KHAMBENH_TOATHUOC_ID = TT.KHAMBENH_TOATHUOC_ID AND TT.TIEPNHAN_ID = @TIEPNHAN_ID INNER JOIN TM_DUOC D ON D.DUOC_ID = TT.DUOC_ID WHERE KBTT.KHAMBENH_ID = @KHAMBENH_ID",
    "param": {
      "TIEPNHAN_ID": "",
      "KHAMBENH_ID": ""
    }
  },
  {
    "code": "SCHUNGTUNT",
    "query": "SELECT ld.DICTIONARY_NAME as LOAI,tdc.MUCDICHCHUNGTU_CODE as MA, CT.SOLONHAP_ID, FORMAT(tdc.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') as NGAYCHUNGTU,tdc.MACHUNGTU,tdc.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, tdc.KHOXUAT_ID as KX_ID,kx.TENKHO AS KHOXUAT, tdc.KHONHAP_ID as KN_ID,kn.TENKHO AS KHONHAP, CAST(CT.SOLUONGYEUCAU as DECIMAL(10, 3)) as SOLUONGYEUCAU, CAST(CT.SOLUONGDAXUAT as DECIMAL(10, 3)) as SOLUONGDAXUAT, tdc.DIENGIAINGHIEPVUPHATSINH FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER join TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID INNER join LST_DICTIONARY ld (NOLOCK) on ld.DICTIONARY_ID = tdc.MUCDICHCHUNGTU_ID AND ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' LEFT JOIN TM_KHODUOC kn ON kn.KHODUOC_ID = tdc.KHONHAP_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = tdc.KHOXUAT_ID where CT.TOATHUOCNGOAITRU_ID =  @TOATHUOC_ID ORDER BY tdc.CHUNGTU_ID",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "THUOCPTTT",
    "query": "SELECT PT.PHAUTHUAT_ID,PT.SOPHIEUPHAUTHUAT, VTYT.PHAUTHUAT_VTYT_ID,D.TENDUOCDAYDU, isnull(td.TENDICHVU,'NULL') as TENDICHVU, CAST(VTYT.SOLUONG as DECIMAL(10, 3)) AS SOLUONG,VTYT.TINHTIEN, VTYT.BNTUCHITRA, VTYT.DUTRUCHITIET_VTYT_ID FROM TT_PHAUTHUAT PT (NOLOCK) INNER JOIN TT_PHAUTHUAT_VTYT VTYT (NOLOCK) ON PT.PHAUTHUAT_ID = VTYT.PHAUTHUAT_ID INNER JOIN TM_DUOC  D ON D.DUOC_ID = VTYT.DUOC_ID INNER JOIN TM_LOAIDUOC tl ON D.LOAIDUOC_ID = tl.LOAIDUOC_ID left JOIN TM_DICHVU td ON VTYT.DICHVU_ID = td.DICHVU_ID WHERE TIEPNHAN_ID  =@TIEPNHAN_ID AND ((@THUOC = 1 AND tl.LOAIVATTU_ID = 'T') OR (@VTYT = 1 AND tl.LOAIVATTU_ID = 'V'))",
    "param": {
      "TIEPNHAN_ID": "",
      "THOIGIANKHAM": "",
      "THUOC": "",
      "VTYT": ""
    }
  },
  {
    "code": "SCHUNGTUPTTT",
    "query": "SELECT ld.DICTIONARY_NAME as LOAI,tdc.MUCDICHCHUNGTU_CODE as MA, CT.SOLONHAP_ID, FORMAT(tdc.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') as NGAYCHUNGTU,tdc.MACHUNGTU,tdc.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, tdc.KHOXUAT_ID as KX_ID,kx.TENKHO AS KHOXUAT, tdc.KHONHAP_ID as KN_ID,kn.TENKHO AS KHONHAP, CAST(CT.SOLUONGYEUCAU as DECIMAL(10, 3)) as SOLUONGYEUCAU, CAST(CT.SOLUONGDAXUAT as DECIMAL(10, 3)) as SOLUONGDAXUAT, tdc.DIENGIAINGHIEPVUPHATSINH FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER join TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID INNER join LST_DICTIONARY ld (NOLOCK) on ld.DICTIONARY_ID = tdc.MUCDICHCHUNGTU_ID AND ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' LEFT JOIN TM_KHODUOC kn ON kn.KHODUOC_ID = tdc.KHONHAP_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = tdc.KHOXUAT_ID where CT.PHAUTHUAT_VTYT_ID =  @PHAUTHUAT_VTYT_ID ORDER BY tdc.CHUNGTU_ID",
    "param": {
      "PHAUTHUAT_VTYT_ID": ""
    }
  },
  {
    "code": "THUOCCLS",
    "query": "SELECT VTYT.CLSKETQUA_VTYT_ID,VTYT.DVYEUCAU_ID,D.TENDUOCDAYDU ,CAST(VTYT.SOLUONG as DECIMAL(10, 3)) AS SOLUONG ,DV.TENDICHVU, VTYT.TINHTIEN, vtyt.BHYTDONGTIEN FROM TT_CLSKETQUA_VTYT VTYT (NOLOCK) INNER JOIN TT_DVYEUCAU YC  (NOLOCK) ON VTYT.DVYEUCAU_ID = YC.DVYEUCAU_ID INNER JOIN TM_DUOC D (NOLOCK) ON VTYT.DUOC_ID = D.DUOC_ID INNER JOIN TM_DICHVU DV (NOLOCK) ON DV.DICHVU_ID = YC.DICHVU_ID WHERE YC.TIEPNHAN_ID =@TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "SCHUNGTUCLS",
    "query": "SELECT ld.DICTIONARY_NAME as LOAI,tdc.MUCDICHCHUNGTU_CODE as MA, CT.SOLONHAP_ID, FORMAT(tdc.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') as NGAYCHUNGTU,tdc.MACHUNGTU,tdc.CHUNGTU_ID, CT.CHUNGTUCHITIET_ID, tdc.KHOXUAT_ID as KX_ID,kx.TENKHO AS KHOXUAT, tdc.KHONHAP_ID as KN_ID,kn.TENKHO AS KHONHAP, CAST(CT.SOLUONGYEUCAU as DECIMAL(10, 3)) as SOLUONGYEUCAU, CAST(CT.SOLUONGDAXUAT as DECIMAL(10, 3)) as SOLUONGDAXUAT, tdc.DIENGIAINGHIEPVUPHATSINH FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER join TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID INNER join LST_DICTIONARY ld (NOLOCK) on ld.DICTIONARY_ID = tdc.MUCDICHCHUNGTU_ID AND ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' LEFT JOIN TM_KHODUOC kn ON kn.KHODUOC_ID = tdc.KHONHAP_ID LEFT JOIN TM_KHODUOC kx ON kx.KHODUOC_ID = tdc.KHOXUAT_ID where CT.CLSKETQUA_VTYT_ID =  @CLSKETQUA_VTYT_ID ORDER BY tdc.CHUNGTU_ID",
    "param": {
      "CLSKETQUA_VTYT_ID": ""
    }
  },
  {
    "code": "UPDSAIKHO",
    "query": "update kb set KHODUOC_ID = KHOPHAT_ID from  TT_NOITRU_KHAMBENH (NOLOCK) kb inner join TT_NOITRU_BENHAN (NOLOCK) ba on ba.BENHAN_ID = kb.BENHAN_ID and ba.THOIGIANRAVIEN is null inner join TT_NOITRU_TOATHUOC (NOLOCK) tt on kb.KHAMBENH_ID = tt.KHAMBENH_ID and SOLUONGTHUCLINH > 0 and kb.RAVIEN ='0' and kb.ISYLENHVTYT ='0' and HUYTOATHUOC ='0' inner join TM_KHODUOC (NOLOCK) k0 on k0.KHODUOC_ID = kb.KHODUOC_ID inner join TM_KHODUOC (NOLOCK) k1 on k1.KHODUOC_ID = tt.KHOPHAT_ID inner join TM_KHODUOC (NOLOCK) k2 on k2.KHODUOC_ID = tt.KHOTAO_ID inner join LST_DICTIONARY (NOLOCK) d0 on d0.DICTIONARY_ID = k0.LOAIKHO_ID and d0.DICTIONARY_CODE = 'CoSo' inner join LST_DICTIONARY (NOLOCK) d1 on d1.DICTIONARY_ID = k1.LOAIKHO_ID and d1.DICTIONARY_CODE = 'KhoLe' inner join LST_DICTIONARY (NOLOCK) d2 on d2.DICTIONARY_ID = k2.LOAIKHO_ID and d2.DICTIONARY_CODE = 'KhoBenhNhan' WHERE tt.TIEPNHAN_ID = @TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "GETBNMONGO",
    "query": "select top 1 a.MAYTE as _id,a.BENHNHAN_ID,a.MAYTE,null FID,a.HO,a.TEN,a.TENBENHNHAN,a.GIOITINH as GIOITINH_ID,a.NGAYSINH,a.NAMSINH,a.SODIENTHOAI,a.DIACHILIENLAC,a.DIACHITHUONGTRU, a.HINHANH_DAIDIEN,a.TIENSUBENH,a.TIENSUDIUNG,a.TUVONG,a.CMND,a.GIOITINH,a.NGHENGHIEP_ID, gd.DESCRIPTION TENGIOITINH, (CASE WHEN CONVERT(int,ROUND(DATEDIFF(hour,NGAYSINH,GETDATE())/8766.0,0)) >= 16 THEN 'NGUOILON' ELSE 'TREEM' END) DOTUOI,NN.DICTIONARY_NAME NGHENGHIEP,a.DIACHICOQUAN,a.DONVICONGTAC_ID,a.GHICHU,a.SONHA,a.QUANHUYEN_ID,a.XAPHUONG_ID,tn.TIEPNHAN_ID TIEPNHAN_ID,tn.DOITUONG_ID from TT_BENHNHAN A join TM_GENDER GD on GD.ID = a.GIOITINH left join TT_TIEPNHAN TN on TN.BENHNHAN_ID = a.BENHNHAN_ID left join LST_DICTIONARY NN on NN.DICTIONARY_ID = a.NGHENGHIEP_ID where  a.MAYTE = @MAYTE order by tn.TIEPNHAN_ID desc FOR JSON  path,INCLUDE_NULL_VALUES",
    "param": {
      "MAYTE": ""
    }
  },
  {
    "code": "SGIUONG",
    "query": "SELECT tnl.LUUTRUCHITIET_ID, LT.LUUTRU_ID,tp.TENPHONGBAN, tp1.TENPHONGBAN AS PHONG, tg.MAGIUONG, FORMAT(tnl.THOIGIANVAO, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANVAO,  FORMAT(tnl.THOIGIANRA, 'dd/MM/yyyy HH:mm:ss') AS THOIGIANRA , tnl.SONGAY, tnl.SONGAYBHYT, tnl.LOAIGIUONGBENH_ID, td.TENDICHVU, tnl.DICHVU_CONGCHAMSOC_ID,tnl.LOAIGIA_ID, tnl.BAOPHONG, tnl.BAOGIUONG FROM TT_NOITRU_BENHAN BA INNER JOIN TT_NOITRU_LUUTRU LT ON BA.BENHAN_ID = LT.BENHAN_ID INNER JOIN TT_NOITRU_LUUTRUCHITIET tnl ON LT.LUUTRU_ID = tnl.LUUTRU_ID LEFT JOIN TM_PHONGBAN tp ON tnl.PHONGBAN_ID = tp.PHONGBAN_ID LEFT JOIN TM_PHONGBAN tp1 ON tnl.PHONGBENH_ID = tp1.PHONGBAN_ID LEFT JOIN TM_GIUONGBENH tg ON tnl.GIUONGBENH_ID = tg.GIUONGBENH_ID LEFT JOIN TM_DICHVU td ON tnl.LOAIGIUONGBENH_ID = td.DICHVU_ID WHERE BA.BENHAN_ID = @BENHAN_ID ORDER BY tnl.THOIGIANVAO",
    "param": {
      "BENHAN_ID": ""
    }
  },
  {
    "code": "SXNBHYT",
    "query": "SELECT tx.XACNHANCHIPHI_ID AS ID, tx.XACNHANCHIPHICHITIET_ID AS XNCT_ID,XN.LOAI,FORMAT(XN.THOIGIANXACNHAN,'dd/MM/yyyy HH:mm:ss') AS TGXACNHAN ,tx.VIENPHI_ID,tx.IDREF, tx.NOIDUNG_ID, tx.NOIDUNG, cast(tx.SOLUONG as DECIMAL(10, 3)) AS SL, tx.DONGIAHOTRO, tx.DONGIAHOTROCHITRA, tv.REF_TABLE FROM TT_XACNHANCHIPHI XN INNER JOIN TT_XACNHANCHIPHICHITIET tx ON XN.XACNHANCHIPHI_ID = tx.XACNHANCHIPHI_ID INNER JOIN TT_VIENPHI tv ON tx.VIENPHI_ID = tv.VIENPHI_ID where XN.TIEPNHAN_ID = @TIEPNHAN_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "sDIC",
    "query": "SELECT top 200 DICTIONARY_ID ,DICTIONARY_TYPE_ID ,DICTIONARY_TYPE_CODE ,DICTIONARY_CODE ,DICTIONARY_NAME ,CAST(ENABLED as bit) as ENABLED FROM LST_DICTIONARY where DICTIONARY_TYPE_CODE LIKE '%' + @TEXT + '%' OR DICTIONARY_NAME LIKE '%' + @TEXT + '%' OR cast(DICTIONARY_ID as VARCHAR(250)) = @TEXT",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "GETDICHGQ",
    "query": "SELECT DICTIONARY_ID ,DICTIONARY_TYPE_ID ,DICTIONARY_TYPE_CODE ,DICTIONARY_CODE ,DICTIONARY_NAME,CAST(ENABLED as bit) as ENABLED FROM LST_DICTIONARY where DICTIONARY_TYPE_CODE = 'GiaiQuyetKhamBenh' ORDER BY ENABLED DESC,IDX ASC",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "GETDICCK",
    "query": "SELECT CHUYENKHOA_ID ,MACHUYENKHOA ,TENCHUYENKHOA ,CAST(TAMNGUNG as bit) as TAMNGUNG,CHUYENKHOA_ID_NOITRU ,CHUYENKHOA_ID_NGOAITRU ,LOAIBENHAN ,MACHUYENKHOAEBS FROM TM_CHUYENKHOA",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "GETDICLBA",
    "query": "SELECT LOAIBENHAN_ID ,MALOAIBENHAN ,TENLOAIBENHAN ,CAST(TAMNGUNG as bit) as TAMNGUNG,PROPERTY1 ,PROPERTY2 ,PROPERTY3 FROM TM_LOAIBENHAN",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "sHD",
    "query": "SELECT  HOADON_ID, SOHOADON,BENHAN_ID,format(NGAYHOADON,'dd/MM/yyyy HH:mm:ss') AS NGAYHOADON, LOAIHOADON, GIATRIHOADON, GIATRITHUCTHU, HUYHOADON, HOANTRA, DATHANHTOAN, TRANGTHAI, format(THOIGIAN_DUYET_HUY,'dd/MM/yyyy HH:mm:ss') AS TG_DUYET_HUY, format(THOIGIAN_HUY_HOANTRA,'dd/MM/yyyy HH:mm:ss') AS TG_HUY_HOANTRA, THUTHEM FROM TT_HOADON where TIEPNHAN_ID = @TIEPNHAN_ID ORDER BY HOADON_ID",
    "param": {
      "TIEPNHAN_ID": ""
    }
  },
  {
    "code": "GETKD",
    "query": "SELECT tk.KHODUOC_ID ,tk.MAKHO ,tk.TENKHO ,tk.LOAIKHO_ID ,tk.LOAIDUOC ,tk.PHONGBAN_ID ,CAST(tk.TAMNGUNG AS BIT) as TAMNGUNG FROM TM_KHODUOC tk  where tk.TENKHO LIKE '%' + @TEXT + '%' OR tk.MAKHO LIKE '%' + @TEXT + '%' OR cast(tk.KHODUOC_ID as VARCHAR(250)) = @TEXT",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "GETPB",
    "query": "SELECT tp.PHONGBAN_ID ,tp.MAPHONGBAN ,tp.TENPHONGBAN ,tp.LOAIPHONGBAN_ID ,ld.DICTIONARY_NAME AS LOAIPHONGBAN ,tp.CAP ,tp.CAPTREN_ID ,tp.TAMNGUNG ,tp.MAPHONGBANBYT ,tp.IPD_BLOCK_VP ,tp.IPD_BLOCK_BH FROM TM_PHONGBAN tp INNER JOIN LST_DICTIONARY ld ON tp.LOAIPHONGBAN_ID = ld.DICTIONARY_ID AND ld.DICTIONARY_TYPE_CODE = 'LoaiPhongBan' where tp.TENPHONGBAN LIKE '%' + @TEXT + '%' OR tp.MAPHONGBAN LIKE '%' + @TEXT + '%' OR tp.MAPHONGBANBYT LIKE '%' + @TEXT + '%' OR cast(tp.PHONGBAN_ID as VARCHAR(250)) = @TEXT",
    "param": {
    }
  },
  {
    "code": "GETCACHE",
    "query": "SELECT ID ,DAO_ID ,STATEMENT_ID ,RESULT_VALUE ,RESULT_TEXT ,CONDITIONS ,CAST(ACTIVE AS BIT) AS ACTIVE ,UPDATE_TIME ,TABLE_AFFECT FROM TM_SYS_CACHE where ID LIKE '%' + @TEXT + '%'",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "GETAPPSETTING",
    "query": "SELECT tsa.SETTING_ID ,tsa.CODE ,tsa.VALUE ,tsa.DESCRIPTION ,CAST(tsa.LOCKED AS BIT) AS LOCKED ,tsa.TYPE FROM TM_SYS_APPSETTINGS tsa where tsa.CODE LIKE '%' + @TEXT + '%' OR tsa.DESCRIPTION LIKE '%' + @TEXT + '%'",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "SDUOC",
    "query": "SELECT top 100 DUOC_ID,MADUOC,TENDUOCDAYDU, tl.LOAIVATTU_ID, D.DONVITINH,cast(D.TAMNGUNG as BIT ) AS TAMNGUNG FROM TM_DUOC D LEFT join TM_LOAIDUOC tl ON D.LOAIDUOC_ID = tl.LOAIDUOC_ID where D.TENDUOCDAYDU LIKE '%' + @TEXT + '%' OR D.MADUOC = @TEXT OR cast(D.DUOC_ID as VARCHAR(250)) = @TEXT",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "SDICHVU",
    "query": "SELECT top 100 DV.DICHVU_ID, tn.TENNHOMDICHVU,DV.MADICHVU, DV.TENDICHVU,DV.CAPTREN_ID, cast(DV.TAMNGUNG  AS bit ) TAMNGUNG FROM TM_DICHVU DV INNER JOIN TM_NHOMDICHVU tn ON DV.NHOMDICHVU_ID = tn.NHOMDICHVU_ID where DV.TENDICHVU LIKE N'%' + @TEXT + '%' OR cast(DV.DICHVU_ID as VARCHAR(250)) = @TEXT",
    "param": {
      "TEXT": ""
    }
  },
  {
    "code": "DELTHYL",
    "query": "DELETE TT_NOITRU_THUCHIENYLENH WHERE THYL_ID IN ( SELECT max(THYL_ID) FROM TT_NOITRU_THUCHIENYLENH where TOATHUOC_ID in (@SLTTOATHUOC_ID) AND TRANGTHAITHUCHIENYLENH != 'NGUNGSUDUNG' GROUP BY TOATHUOC_ID )",
    "param": {
      "SLTTOATHUOC_ID": ""
    }
  },
  {
    "code": "sTHUOCNGUNG",
    "query": "SELECT CT.TRATHUOC_ID, CT.TRATHUOCCHITIET_ID, TT.SOPHIEU, TT.BENHAN_ID,FORMAT(TT.THOIGIANTRA,'dd/MM/yyyy HH:mm:ss') AS THOIGIANTRA, CT.CHUNGTUTRA_ID,CAST(CT.DAHOANTRA AS BIT) DAHOANTRA, CT.SOLUONG, TT.GHICHU FROM TT_NOITRU_TRATHUOC TT INNER JOIN TT_NOITRU_TRATHUOC_CHITIET CT ON TT.TRATHUOC_ID = CT.TRATHUOC_ID WHERE CT.TOATHUOC_ID = @TOATHUOC_ID",
    "param": {
      "TOATHUOC_ID": ""
    }
  },
  {
    "code": "GET_KHAMCK",
    "query": "SELECT KB.KHAMBENH_ID, FORMAT(KB.THOIGIANKHAM,'dd/MM/yyyy HH:mm:ss') AS THOIGIANKHAM  FROM TT_DVYEUCAU YC INNER JOIN TT_NOITRU_KHAMBENH KB ON KB.KHAMBENH_ID = YC.KHAMBENH_NOITRU_ID AND KB.KHAMCHUYENKHOA = '1' WHERE YC.DVYEUCAU_ID = @DVYEUCAU_ID AND YC.TIEPNHAN_ID = @TIEPNHAN_ID AND YC.KHAMCHUYENKHOA = '1'",
    "param": {
      "TIEPNHAN_ID": "",
      "DVYEUCAU_ID": ""
    }
  },
  {
    "code": "GETCTBYMA",
    "query": "DECLARE @TABLE as TABLE(CHUNGTU_ID INT,MUCDICHCHUNGTU_CODE VARCHAR(10),MACHUNGTU VARCHAR(100),MUCDICHCHUNGTU_ID INT, CHUNGTULIENQUAN_ID INT, SOCHUNGTUGOC NVARCHAR(250),KHOXUAT_ID INT, KHONHAP_ID INT) DECLARE\t@SOCHUNGTUGOC NVARCHAR(100) DECLARE @CHUNGTULIENQUAN_ID INT INSERT INTO @TABLE SELECT CT.CHUNGTU_ID,CT.MUCDICHCHUNGTU_CODE,CT.MACHUNGTU,CT.MUCDICHCHUNGTU_ID,CT.CHUNGTULIENQUAN_ID,CT.SOCHUNGTUGOC,CT.KHOXUAT_ID,CT.KHONHAP_ID FROM TT_DUOC_CHUNGTU CT where CT.MACHUNGTU = @MACHUNGTU SELECT top 1 @CHUNGTULIENQUAN_ID = CHUNGTULIENQUAN_ID,@SOCHUNGTUGOC = SOCHUNGTUGOC FROM @TABLE IF (@CHUNGTULIENQUAN_ID IS NOT NULL ) BEGIN INSERT INTO @TABLE SELECT CT.CHUNGTU_ID,CT.MUCDICHCHUNGTU_CODE,CT.MACHUNGTU,CT.MUCDICHCHUNGTU_ID,CT.CHUNGTULIENQUAN_ID,CT.SOCHUNGTUGOC,CT.KHOXUAT_ID,CT.KHONHAP_ID FROM TT_DUOC_CHUNGTU CT where CT.CHUNGTU_ID = @CHUNGTULIENQUAN_ID END IF @SOCHUNGTUGOC IS NOT NULL BEGIN IF (SUBSTRING(@SOCHUNGTUGOC,4,1) = 'X') BEGIN INSERT INTO @TABLE SELECT CT.CHUNGTU_ID,CT.MUCDICHCHUNGTU_CODE,CT.MACHUNGTU,CT.MUCDICHCHUNGTU_ID,CT.CHUNGTULIENQUAN_ID,CT.SOCHUNGTUGOC,CT.KHOXUAT_ID,CT.KHONHAP_ID FROM TT_DUOC_CHUNGTU CT WHERE CT.MACHUNGTU = @SOCHUNGTUGOC END ELSE BEGIN INSERT INTO @TABLE SELECT PL.CHUNGTU_ID,'PL',PL.MACHUNGTU,1,PL.CHUNGTULIENQUAN_ID,PL.SOCHUNGTUGOC,PL.KHOXUAT_ID,PL.KHONHAP_ID FROM TT_DUOC_PHIEULINH PL WHERE PL.MACHUNGTU = @SOCHUNGTUGOC END END SELECT CHUNGTU_ID,MUCDICHCHUNGTU_CODE AS CODE,MACHUNGTU,CASE WHEN A.MUCDICHCHUNGTU_ID = -1 THEN N'Phiếu Lĩnh' ELSE ld.DICTIONARY_NAME END AS LOAI_CHUNGTU,SOCHUNGTUGOC,KHOXUAT_ID,tk.TENKHO AS KHOXUAT,KHONHAP_ID,tk1.TENKHO AS KHONHAP FROM @TABLE A LEFT JOIN LST_DICTIONARY ld on ld.DICTIONARY_ID = A.MUCDICHCHUNGTU_ID and ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' LEFT join TM_KHODUOC tk ON A.KHOXUAT_ID = tk.KHODUOC_ID LEFT join TM_KHODUOC tk1 ON A.KHONHAP_ID = tk1.KHODUOC_ID ORDER BY CHUNGTU_ID",
    "param": {
      "MACHUNGTU": ""
    }
  },
  {
    "code": "GETCTCHITIET",
    "query": "SELECT CHUNGTUCHITIET_ID, a.DUOC_ID,td.TENDUOCDAYDU,SOLONHAP_ID, SOLUONGDAXUAT, CASE WHEN a.TOATHUOCNOITRU_ID is NOT NULL THEN 'TT_NOITRU_TOATHUOC' WHEN a.TOATHUOCNGOAITRU_ID is NOT NULL THEN 'TT_NGOAITRU_TOATHUOC' WHEN a.PHAUTHUAT_VTYT_ID is NOT NULL THEN 'TT_PHAUTHUAT_VTYT' WHEN a.CLSKETQUA_VTYT_ID is NOT NULL THEN 'TT_CLSKETQUA_VTYT' ELSE null END as REF_TABLE, COALESCE(a.TOATHUOCNOITRU_ID,a.TOATHUOCNGOAITRU_ID,a.PHAUTHUAT_VTYT_ID,a.CLSKETQUA_VTYT_ID) as REF_ID FROM TT_DUOC_CHUNGTU_CHITIET a INNER JOIN TM_DUOC td on a.DUOC_ID = td.DUOC_ID where a.CHUNGTU_ID = @CHUNGTU_ID",
    "param": {
      "CHUNGTU_ID": ""
    }
  },
  {
    "code": "sDDT",
    "query": "SELECT DOTDIEUTRI_ID ,MADOTDIEUTRI ,TENDOTDIEUTRI ,FORMAT(THOIGIANTUNGAY,'dd/MM/yyyy HH:mm:ss') AS TUNGAY ,FORMAT(THOIGIANDENNGAY,'dd/MM/yyyy HH:mm:ss') AS TGNDENNGAY ,TRANGTHAI ,DAXACNHAN_BHYT ,tp.TENPHONGBAN ,tn.TENNHANVIEN AS BACSIDIEUTRI FROM TT_NOITRU_DOTDIEUTRI a LEFT JOIN TM_NHANVIEN tn on a.BACSYDIEUTRI_ID = tn.NHANVIEN_ID LEFT join TM_PHONGBAN tp on a.KHOADIEUTRI_ID = tp.PHONGBAN_ID WHERE a.BENHAN_ID = @BENHAN_ID",
    "param": {
      "BENHAN_ID": ""
    }
  },
  {
    "code": "sTHUOCBYCT",
    "query": "SELECT CONCAT(tb.MAYTE,' - ',tb.TENBENHNHAN,' - ',KB.KHAMBENH_ID,N' - Thời gian YLệnh: ',format(KB.THOIGIANBATDAU,'dd/MM/yyyy HH:mm:ss')) AS BENHNHAN, CT.LOAI,td.TENDUOCDAYDU as TENDUOC,CT.MA ,CT.SOLONHAP_ID ,CT.NGAYCHUNGTU ,CT.MACHUNGTU ,CT.CHUNGTU_ID ,CT.CHUNGTUCHITIET_ID ,CT.SOLUONGYEUCAU ,CT.SOLUONGDAXUAT ,CT.DIENGIAINGHIEPVUPHATSINH FROM TT_NOITRU_KHAMBENH KB INNER JOIN TT_NOITRU_TOATHUOC tnt ON KB.KHAMBENH_ID = tnt.KHAMBENH_ID INNER JOIN TT_TIEPNHAN TN ON tnt.TIEPNHAN_ID = TN.TIEPNHAN_ID INNER JOIN TT_BENHNHAN tb ON TN.BENHNHAN_ID = tb.BENHNHAN_ID LEFT JOIN (SELECT LOAI = N'Phiếu lĩnh' ,MA = 'PL' ,CT.SOLONHAP_ID ,FORMAT(PL.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS NGAYCHUNGTU ,PL.MACHUNGTU ,PL.CHUNGTU_ID ,CT.CHUNGTUCHITIET_ID ,CAST(CT.SOLUONGYEUCAU AS DECIMAL(10, 3)) AS SOLUONGYEUCAU ,CAST(CT.SOLUONGDAXUAT AS DECIMAL(10, 3)) AS SOLUONGDAXUAT ,'' AS DIENGIAINGHIEPVUPHATSINH,CT.TOATHUOCNOITRU_ID FROM TT_DUOC_PHIEULINH_CHITIET CT INNER JOIN TT_DUOC_PHIEULINH PL ON PL.CHUNGTU_ID = CT.CHUNGTU_ID WHERE CT.TOATHUOCNOITRU_ID IN (@SLTTOATHUOC_ID) UNION ALL SELECT ld.DICTIONARY_NAME AS LOAI ,tdc.MUCDICHCHUNGTU_CODE AS MA ,CT.SOLONHAP_ID ,FORMAT(tdc.NGAYCHUNGTU, 'dd/MM/yyyy HH:mm:ss') AS NGAYCHUNGTU ,tdc.MACHUNGTU ,tdc.CHUNGTU_ID ,CT.CHUNGTUCHITIET_ID ,CAST(CT.SOLUONGYEUCAU AS DECIMAL(10, 3)) AS SOLUONGYEUCAU ,CAST(CT.SOLUONGDAXUAT AS DECIMAL(10, 3)) AS SOLUONGDAXUAT ,tdc.DIENGIAINGHIEPVUPHATSINH,CT.TOATHUOCNOITRU_ID FROM TT_DUOC_CHUNGTU_CHITIET CT (NOLOCK) INNER JOIN TT_DUOC_CHUNGTU tdc (NOLOCK) ON CT.CHUNGTU_ID = tdc.CHUNGTU_ID INNER JOIN LST_DICTIONARY ld (NOLOCK) ON ld.DICTIONARY_ID = tdc.MUCDICHCHUNGTU_ID AND ld.DICTIONARY_TYPE_CODE = 'MucDichChungTu' WHERE CT.TOATHUOCNOITRU_ID IN (@SLTTOATHUOC_ID) and tdc.MUCDICHCHUNGTU_CODE not in ('X07','N05') ) CT ON tnt.TOATHUOC_ID = CT.TOATHUOCNOITRU_ID LEFT join TM_DUOC td on tnt.DUOC_ID = td.DUOC_ID WHERE tnt.TOATHUOC_ID IN (@SLTTOATHUOC_ID)",
    "param": {
      "SLTTOATHUOC_ID": ""
    }
  },
  {
    "code": "GETREFINFOVP",
    "query": "IF (@REF_TABLE = 'TT_NOITRU_TOATHUOC') BEGIN SELECT CONCAT(N'THỜI GIAN KHÁM: ',FORMAT(CASE when KB.ISYLENHVTYT = 1 then KB.THOIGIANKHAM ELSE  KB.THOIGIANKHAM END , 'dd/MM/yyyy HH:mm:ss'),'\nKHAMBENH_ID: ',KB.KHAMBENH_ID) as TEXT FROM TT_NOITRU_KHAMBENH KB INNER JOIN TT_NOITRU_TOATHUOC tnt ON KB.KHAMBENH_ID = tnt.KHAMBENH_ID WHERE tnt.TOATHUOC_ID = @REF_ID END ELSE IF (@REF_TABLE = 'TT_DVYEUCAU') BEGIN SELECT concat(N'THỜI GIAN YÊU CẦU: ',FORMAT(NGAYGIOYEUCAU, 'dd/MM/yyyy HH:mm:ss'),N'\nSỐ PHIẾU YC: ',SOPHIEUYEUCAU,N'\nTRẠNG THÁI: ',TRANGTHAI) as TEXT FROM TT_DVYEUCAU where DVYEUCAU_ID =  @REF_ID END",
    "param": {
      "REF_ID": "",
      "REF_TABLE": ""
    }
  }
]